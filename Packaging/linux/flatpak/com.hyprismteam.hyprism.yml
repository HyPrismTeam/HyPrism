app-id: dev.hyprism.HyPrism
runtime: org.freedesktop.Platform
runtime-version: '24.08'
sdk: org.freedesktop.Sdk
base: org.electronjs.Electron2.BaseApp
base-version: '24.08'
command: hyprism-launcher-wrapper.sh

sdk-extensions:
  - org.freedesktop.Sdk.Extension.node22

build-options:
  append-path: /usr/lib/sdk/node18/bin

finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --socket=pulseaudio
  - --share=network
  - --device=dri
  - --talk-name=org.freedesktop.Notifications
  - --env=LD_LIBRARY_PATH=/app/lib
  - --env=ELECTRON_TRASH=gio
  - --env=XCURSOR_PATH=/run/host/user-share/icons:/run/host/share/icons

modules:
  # - name: libpng
  #   buildsystem: autotools
  #   sources:
  #     - type: archive
  #       url: https://download.sourceforge.net/libpng/libpng-1.6.43.tar.xz
  #       sha256: 6a5ca0652392a2d7c9db2ae5b40210843c0bbc081cbd410825ab00cc59f14a6c

  # - name: SDL3
  #   buildsystem: cmake-ninja
  #   config-opts:
  #     - -DSDL_STATIC=OFF
  #     - -DSDL_TEST=OFF
  #   sources:
  #     - type: git
  #       url: https://github.com/libsdl-org/SDL.git
  #       tag: release-3.2.8

  # - name: SDL3_image
  #   buildsystem: cmake-ninja
  #   config-opts:
  #     - -DSDL3IMAGE_PNG=ON
  #     - -DSDL3IMAGE_BACKEND_STB=OFF
  #   sources:
  #     - type: git
  #       url: https://github.com/libsdl-org/SDL_image.git
  #       tag: release-3.2.4

  - name: HyPrism
    buildsystem: simple
    build-commands:
      - install -d /app/lib/hyprism
      - "sh -c 'if [ -x bundle/HyPrism ]; then install -Dm755 bundle/HyPrism /app/lib/hyprism/HyPrism; elif [ -x bundle/linux-unpacked/HyPrism ]; then install -Dm755 bundle/linux-unpacked/HyPrism /app/lib/hyprism/HyPrism; else echo HyPrism binary not found in bundle >&2; false; fi'"
      - cp -R bundle/wwwroot /app/lib/hyprism/ 2>/dev/null || true
      - cp -R bundle/runtimes /app/lib/hyprism/ 2>/dev/null || true
      - install -Dm644 bundle/jre.json /app/lib/hyprism/jre.json 2>/dev/null || true
      - install -d /app/bin
      - install -Dm755 hyprism-launcher-wrapper.sh /app/bin/hyprism-launcher-wrapper.sh
      - chmod +x /app/bin/hyprism-launcher-wrapper.sh
      - install -Dm644 icon.png /app/share/icons/hicolor/256x256/apps/com.hyprismteam.hyprism.png
      - install -Dm644 dev.hyprism.HyPrism.desktop /app/share/applications/HyPrism.desktop
      - install -Dm644 com.hyprismteam.hyprism.metainfo.xml /app/share/metainfo/com.hyprismteam.hyprism.metainfo.xml
    sources:
      - type: dir
        path: bundle
        dest: bundle
      - type: file
        path: ../../../Frontend/public/icon.png
      - type: file
        path: hyprism-launcher-wrapper.sh
      - type: file
        path: com.hyprismteam.hyprism.desktop
      - type: file
        path: com.hyprismteam.hyprism.metainfo.xml
